'use strict';var generateSignature=function(a){var b=[],c=[],d=[],e={},f={name:'',topTrack:{}},g=function getUserLibrary(){var p=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,q='https://api.spotify.com/v1/me/tracks?limit=50&offset='+p;fetch(q,{method:'GET',headers:{Authorization:'Bearer '+a}}).then(function(s){return s.json()}).then(function(s){if(f.totalSongs=s.total,b=b.concat(s.items),b.length<f.totalSongs)g(p+=50);else{for(var t=0;t<f.totalSongs;t++)c.push(b[t].track.id);h()}})},h=function getAudioFeatures(){var p=c.slice(0,100),q='https://api.spotify.com/v1/audio-features?ids='+p.toString();fetch(q,{method:'GET',headers:{Authorization:'Bearer '+a}}).then(function(s){return s.json()}).then(function(s){d=d.concat(s.audio_features),d.length<f.totalSongs?(c.splice(0,100),h()):j()})},j=function calculateAverages(){for(var p in e=d.reduce(function(p,q){for(var s in p)'number'==typeof p[s]?p[s]+=q[s]:p[s]=null;return p}),e)'number'==typeof e[p]&&('duration_ms'==p?null:e[p]/=f.totalSongs);n(),k()},k=function getUserStats(){fetch('https://api.spotify.com/v1/me',{method:'GET',headers:{Authorization:'Bearer '+a}}).then(function(r){return r.json()}).then(function(r){f.name=r.display_name,l()})},l=function getUserTopArtist(){fetch('https://api.spotify.com/v1/me/top/artists?limit=1&time_range=long_term',{method:'GET',headers:{Authorization:'Bearer '+a}}).then(function(r){return r.json()}).then(function(r){f.topArtist=r.items[0].name,m()})},m=function getUserTopTrack(){fetch('https://api.spotify.com/v1/me/top/tracks?limit=1&time_range=long_term',{method:'GET',headers:{Authorization:'Bearer '+a}}).then(function(r){return r.json()}).then(function(r){f.topTrack.name=r.items[0].name,f.topTrack.artist=r.items[0].artists[0].name,o()})},n=function createCanvas(){var p=document.getElementById('music-signature');console.log(p);for(var q=p.getContext('2d'),r=p.width/d.length,s=p.height,u=0;u<d.length;u++){var v=d[u],w=Math.round(255*v.valence),z=Math.round(255*((1-v.valence)/2)),A=Math.round(255*(1-v.valence)),C=Math.round(40*(1-v.energy)),D=u*r,E=s*v.liveness;console.log(v),q.beginPath(),q.fillStyle='rgba('+w+','+z+','+A+','+0.3+')',q.arc(D,E,C,0,2*Math.PI),q.fill()}var t=document.getElementById('download-image');t.addEventListener('click',function(){this.href=p.toDataURL('image/png');var u=f.name.replace(' ','-').toLowerCase();this.download=(u?u+'-':'')+'music-signature.png'})},o=function displayStats(){var p=f.name.substr(0,f.name.indexOf(' '));document.getElementsByClassName('name')[0].innerText='Hey'+(p?' '+p:'')+',';var q=document.getElementsByClassName('info');q[0].innerText='Here are some basic stats from your Spotify library:',q[1].innerHTML='You have <span>'+f.totalSongs+'</span> songs in your library, with a total length of <span>'+(e.duration_ms/3.6e6).toFixed(1)+'</span> hours.',f.topTrack&&f.topArtist&&(f.topArtist===f.topTrack.artist?q[2].innerHTML='Your top artist is <span class="purple">'+f.topArtist+'</span>, and your favourite song by them is <span class="green">'+f.topTrack.name+'</span>.':q[2].innerHTML='Your top artist is <span class="purple">'+f.topArtist+'</span>, and your favourite song is <span class="green">'+f.topTrack.name+'</span> by <span class="orange">'+f.topTrack.artist+'</span>.');var r=e.duration_ms/(6e4*f.totalSongs),s=Math.floor(r),t=Math.round(60*(r%1));q[3].innerHTML='The average song in your library has <span>'+Math.round(e.tempo)+'</span> beats per minute, and is <span>'+s+':'+t+' minutes </span>long.';var u=!!(0.45<e.valence);q[5].innerHTML='You generally listen to <span class="'+(u?'orange':'blue')+'">'+(u?'happier':'sadder')+'</span> music.',document.getElementById('loader').classList.add('fadeOut'),document.getElementById('loader').addEventListener('transitionend',function(){document.getElementById('music-signature').classList.add('fadeIn');for(var w=document.getElementsByClassName('info-wrap'),z=0;z<w.length;z++)w[z].classList.add('fadeIn')},!1)};g()};