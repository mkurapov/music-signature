'use strict';var generateSignature=function(a){var b=[],c=[],d=[],e={},f={name:'',topTrack:{}},g=function(){var p=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,q='https://api.spotify.com/v1/me/tracks?limit=50&offset='+p;fetch(q,{method:'GET',headers:{Authorization:'Bearer '+a}}).then(function(s){return s.json()}).then(function(s){if(f.totalSongs=s.total,b=b.concat(s.items),b.length<f.totalSongs)g(p+=50);else{for(var t=0;t<f.totalSongs;t++)c.push(b[t].track.id);h()}})},h=function(){var p=c.slice(0,100),q='https://api.spotify.com/v1/audio-features?ids='+p.toString();fetch(q,{method:'GET',headers:{Authorization:'Bearer '+a}}).then(function(s){return s.json()}).then(function(s){d=d.concat(s.audio_features),d.length<f.totalSongs?(c.splice(0,100),h()):j()})},j=function(){for(var p in e=d.reduce(function(q,r){for(var t in q)'number'==typeof q[t]?q[t]+=r[t]:q[t]=null;return q}),e)'number'==typeof e[p]&&('duration_ms'===p?null:e[p]/=f.totalSongs);console.log(e),n(),k()},k=function(){fetch('https://api.spotify.com/v1/me',{method:'GET',headers:{Authorization:'Bearer '+a}}).then(function(r){return r.json()}).then(function(r){f.name=r.display_name,l()})},l=function(){fetch('https://api.spotify.com/v1/me/top/artists?limit=1&time_range=long_term',{method:'GET',headers:{Authorization:'Bearer '+a}}).then(function(r){return r.json()}).then(function(r){f.topArtist=r.items[0].name,m()})},m=function(){fetch('https://api.spotify.com/v1/me/top/tracks?limit=1&time_range=long_term',{method:'GET',headers:{Authorization:'Bearer '+a}}).then(function(r){return r.json()}).then(function(r){f.topTrack.name=r.items[0].name,f.topTrack.artist=r.items[0].artists[0].name,o()})},n=function(){var p=document.getElementById('music-signature'),q=document.getElementById('download-image');q.addEventListener('click',function(){this.href=p.toDataURL('image/png');var t=f.name.replace(' ','-').toLowerCase();this.download=(t?t+'-':'')+'music-signature.png'});var r={labels:['Acousticness','Danceability','Energy','Instrumentalness','Liveness','Valence'],datasets:[{label:'Song Analysis',backgroundColor:'rgba(147,210,153,0.7)',borderColor:'rgba(179,181,198,1)',pointBackgroundColor:'rgba(179,181,198,1)',pointBorderColor:'#fff',pointHoverBackgroundColor:'#fff',pointHoverBorderColor:'rgba(179,181,198,1)',data:[e.acousticness,e.danceability,e.energy,e.instrumentalness,e.liveness,e.valence]}]},s=new Chart(p,{type:'radar',data:r,options:{legend:{labels:{fontSize:20,fontFamily:'GraphikRegular',fontColor:'black'}},scales:{scaleLabel:{fontSize:40}}}})},o=function(){var p=f.name.substr(0,f.name.indexOf(' '));document.getElementsByClassName('name')[0].innerText='Hey'+(p?' '+p:'')+',';var q=document.getElementsByClassName('info');q[0].innerText='Here are some basic stats from your Spotify library:',q[1].innerHTML='You have <span>'+f.totalSongs+'</span> songs in your library, with a total length of <span>'+(e.duration_ms/3.6e6).toFixed(1)+'</span> hours.',f.topTrack&&f.topArtist&&(f.topArtist===f.topTrack.artist?q[2].innerHTML='Your top artist is <span class="purple">'+f.topArtist+'</span>, and your favourite song by them is <span class="green">'+f.topTrack.name+'</span>.':q[2].innerHTML='Your top artist is <span class="purple">'+f.topArtist+'</span>, and your favourite song is <span class="green">'+f.topTrack.name+'</span> by <span class="orange">'+f.topTrack.artist+'</span>.');var r=e.duration_ms/(6e4*f.totalSongs),s=Math.floor(r),t=Math.round(60*(r%1));q[3].innerHTML='The average song in your library has <span>'+Math.round(e.tempo)+'</span> beats per minute, and is <span>'+s+':'+t+' minutes </span>long.';var u=!!(0.45<e.valence);q[5].innerHTML='You generally listen to <span class="'+(u?'orange':'blue')+'">'+(u?'happier':'sadder')+'</span> music.',document.getElementById('loader').classList.add('fadeOut'),document.getElementById('loader').addEventListener('transitionend',function(){document.getElementById('music-signature').classList.add('fadeIn');for(var w=document.getElementsByClassName('info-wrap'),x=0;x<w.length;x++)w[x].classList.add('fadeIn')},!1)};g()};